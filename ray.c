#include "mlx/mlx.h"
#include <stdio.h>
#include "ray.h"
#include <math.h>
#include <stdlib.h>

int All_Textures[]=               //all 32x32 textures
{
 //Checkerboard
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,1,1,1,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,1,1,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1,

 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 
 //Brick
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
 //Window
 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,    
       
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 

 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,   
       
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,  
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,
 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 
 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
 //Door
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,    
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,    
 0,0,0,1,1,1,1,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,1,1,1,1,0,0,0,  
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,  
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,   
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,     

 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,  
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,    
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,    
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,   
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,  
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,  
 0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0,  
 0,0,0,1,1,1,1,1, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 1,1,1,1,1,0,0,0,  

 0,0,0,0,0,0,0,0, 0,0,0,0,0,1,0,1, 1,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,0,0,0,0,0,0,0, 0,0,1,1,1,1,0,1, 1,0,1,1,1,1,0,0, 0,0,0,0,0,0,0,0,   
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,    
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,    
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,   
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0, 
 
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,     
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,   
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,   
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,   
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,  
 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,   
 0,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,0,         
};

#define pi 3.1415926535
#define p2 pi/2
#define p3 3*pi/2
#define DR 0.0174533 //one degree in radians
#define GLSW 1024
#define GLSH 512
#define pixelsize 8
#define tilesize 64
//-----------------------------------STRUCs----------------------------//

typedef struct
{
    int w,a,d,s;
}ButtonKeys; ButtonKeys Keys;


typedef struct
{
    void    *mlx_ptr;
    void    *win_ptr;
    void    *img4;//used
    char    *addr2;//used
    void    *img;//used
    void    *img1;//used
    void    *img2;
    void    *img3;//unused
    char    *addr;
    int     bppx;
    int     line_len;
    int     endian;
    int     bppx2;
    int     line_len2;
    int     endian2;
}datamlx; datamlx data;
//------------------------------------------------------------------//
float px,py,pdx,pdy,pa; //player position

void    drawPlayer()
{
    mlx_put_image_to_window(data.mlx_ptr, data.win_ptr, data.img1, px, py);
}

int color = 0x00FFFF;
////Function to draw the pixel
void    my_mlx_pixel_put(int x, int y)
{
    char    *dst;

    dst=data.addr + (y * data.line_len + x * (data.bppx / 8));
    *(unsigned int*)dst = color;
}
void    my_mlx_pixel_put2(int x, int y)
{
    char    *dst;

    dst=data.addr2 + (y * data.line_len2 + x * (data.bppx2 / 8));
    *(unsigned int*)dst = color;
}
void    drawplayer2()
{
    int temp = py;
    while (temp <(py +pixelsize))
    {
        int tempx = px;
        while (tempx <= (px +pixelsize))
        {
            my_mlx_pixel_put(tempx, temp);
            tempx++;
        }
        temp++;
    }
}
void    drawpwalls(int x, int y, int size, float shade, float ty_Off, float *ty_step, float tx)
{
    int temp = y;
    float ty=ty_Off*(*ty_step);
    while (temp <(y +size))
    {
        float c=All_Textures[(int)(ty)*32 + (int)(tx)]*shade;
        color = 0x00+c*0x00+c*0xFF+c*0x00;
        int tempx = x;
        while (tempx <= (x+8))
        {
            my_mlx_pixel_put2(tempx, temp);
            tempx++;
        }
        temp++;
        ty+=*ty_step;
    }
    mlx_put_image_to_window(data.mlx_ptr,data.win_ptr, data.img4, 512,0 );
}

void    drawtile(int x, int y)
{
    int temp = y;
    while (temp <(y +tilesize-1))
    {
        int tempx = x+1;
        while (tempx <= (x +tilesize-1))
        {
            my_mlx_pixel_put(tempx, temp);
            tempx++;
        }
        temp++;
    }
}
///Clear the data img pointer
void    clear()
{
    int p = 8,d=64;
    //mlx_clear_window(data.mlx_ptr, data.win_ptr);
    
    mlx_destroy_image(data.mlx_ptr, data.img);
    mlx_destroy_image(data.mlx_ptr, data.img2);
    mlx_destroy_image(data.mlx_ptr, data.img1);  //destroy the image saved in img pointer
    data.img = mlx_new_image(data.mlx_ptr, GLSW,GLSH);
    //data.img2 =mlx_new_image(data.mlx_ptr, GLSW,GLSH);
    data.img1 = mlx_xpm_file_to_image(data.mlx_ptr, "pg.xpm", &p, &p);
    data.img4 =mlx_new_image(data.mlx_ptr, GLSW/2, GLSH);
    data.img2 = mlx_xpm_file_to_image(data.mlx_ptr, "dot.xpm", &p, &p);
    data.addr = mlx_get_data_addr(data.img, &data.bppx, &data.line_len, &data.endian);
    data.addr2 = mlx_get_data_addr(data.img4, &data.bppx2, &data.line_len2, &data.endian2);
}

int mapX=8,mapY=8,mapS=64;
int map[]=
{
    1,1,1,1,1,1,1,1,
    1,0,1,0,0,0,0,1,
    1,0,2,0,0,0,0,1,
    1,0,1,0,0,0,0,1,
    1,0,0,0,0,0,0,1,
    1,0,0,0,1,0,0,1,
    1,0,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,
};

void    drawMap2D()
{
    int x,y,xo,yo;
    for(y=0;y<mapY;y++)
    {
        for(x=0;x<mapX;x++)
        {
            xo=x*mapS; yo=y*mapS;
            if(map[y*mapX+x]==1){color=0xFFFFFF;}else{color = 0x0000F0;}
            drawtile(xo, yo);
            if(map[y*mapX+x]==2){color=0xFF05F0;}
                drawtile(xo, yo);
        }
    }
    mlx_put_image_to_window(data.mlx_ptr, data.win_ptr, data.img,0,0);
}

float   dist(float ax,float ay, float bx,float by, float ang)
{
    return(sqrt((bx-ax)*(bx-ax)+(by-ay)*(by-ay)));
}
void  drawRadys3D()
{
    int p = 8;
    int r,mx,my,mp,dof; float rx,ry,ra,xo,yo,disT;
    ra=pa-DR*30; if(ra<0){ ra+=2*pi;} if(ra>2*pi){ ra-=2*pi;}
    for(r=0;r<60;r++)
    {
        ///minute 8:27 to insert "int vmt=0......"
        //try to add cos(degToRad(ca))
        
        //--Check Horizontal Lines--
        dof=0;
        float disH=1000000,hx=px,hy=py;
        float aTan=-1/tan(ra);
        if (ra>pi){ry = (((int)py>>6)<<6)-0.0001; rx=(py-ry)*aTan+px; yo=-64; xo=-yo*aTan;} //looking up
        if (ra<pi){ry = (((int)py>>6)<<6)+64;     rx=(py-ry)*aTan+px; yo= 64; xo=-yo*aTan;} //looking down
        if (ra == 0 || ra==pi) { rx=px; ry=py; dof=8;} //looking straight left or right
        int mv=0,mh=0;
        while (dof<8)
        {
            
            mx=(int)(rx)>>6; my=(int)(ry)>>6; mp=my*mapX+mx;
            //if (mp>0 && mp<mapX*mapY && map[mp] > 1) { hx=rx; hy=ry; disH=dist(px,py,hx,hy,ra); dof = 8; data->color = 'F';} 
            if(mp>0 && mp<mapX*mapY && map[mp] >0){ mh=map[mp]; hx=rx; hy=ry; disH=dist(px,py,hx,hy,ra); dof = 8;}//   hit wall       
            //if(mp>0 && mp<mapX*mapY && map[mp] ==2){ hx=rx; hy=ry; disH=dist(px,py,hx,hy,ra);dof = 8;}
            else{ rx+=xo; ry+=yo; dof+=1;}//next 
        }        
        //Linea verticale
        dof = 0;
        int temps;
        float disV=1000000,vx=px,vy=py;
        float nTan=-tan(ra);
        if (ra>p2 && ra<p3){rx = (((int)px>>6)<<6)-0.0001; ry=(px-rx)*nTan+py; xo=-64; yo=-xo*nTan;} //looking left
        if (ra<p2 || ra>p3){rx = (((int)px>>6)<<6)+64;     ry=(px-rx)*nTan+py; xo= 64; yo=-xo*nTan;} //looking right
        if (ra == 0 || ra==pi) { rx=px; ry=py; dof=8;} //looking straight up or down
        while (dof<8)
        {
            mx=(int)(rx)>>6; my=(int)(ry)>>6; mp=my*mapX+mx;
            //if (mp>0 && mp<mapX*mapY && map[mp] > 1) {vx=rx; vy=ry; disV=dist(px,py,vx,vy,ra);dof = 8 ; data->color = 'F';} 
            if(mp>0 && mp<mapX*mapY && map[mp] >0){ mv=map[mp]; vx=rx; vy=ry; disV=dist(px,py,vx,vy,ra);dof = 8;}//   hit wall
            //if(mp>0 && mp<mapX*mapY && map[mp] ==2){ vx=rx; vy=ry; disV=dist(px,py,vx,vy,ra);dof = 8;}      
            else{   rx+=xo; ry+=yo; dof+=1;}//next  
        }
        float shade=1;
        if(disV<disH){ shade=0.5; rx=vx; ry=vy; disT=disV; color=0xFF0000; if(mv==2) { color=0x0000F0;}}
        if(disH<disV){ rx=hx; ry=hy; disT=disH; color=0xA00000; if(mh==2) { color=0x0000A0;}}
        mlx_put_image_to_window(data.mlx_ptr, data.win_ptr, data.img2, rx, ry);
        ///----------DRAW WALL-----------------
        float ca=pa-ra; if(ca<0){ ca+=2*pi;} if(ca>2*pi){ ca-=2*pi;} disT=disT*cos(ca); //fix fisheye
        float lineH=(mapS*320)/disT; 
        float ty_step=32.0/(float)lineH;
        float ty_Off=0;
        if(lineH>320){ ty_Off=(lineH-320)/2.0; lineH=320;}        
        float lineO=160-lineH/2;
        float tx;
        if(shade==1){tx=(int)(rx/2.0)%32;}// if(ra>1.80){tx=32-tx;}
        else        {tx=(int)(ry/2.0)%32;}
        //printf("%f\n", ra);
        drawpwalls(r*8+530, lineO,lineH, shade, ty_Off, &ty_step, tx);
        ra+=DR; if(ra<0){ ra+=2*pi;} if(ra>2*pi){ ra-=2*pi;}
    }
} 


int    display(datamlx *vosid)
{
    if (Keys.a==1){ pa-=0.1; if(pa<  0){ pa+=2*pi;} pdx=cos(pa)*5; pdy=sin(pa)*5;}
    if (Keys.d==1){ pa+=0.1; if(pa>2*pi){ pa-=2*pi;} pdx=cos(pa)*5; pdy=sin(pa)*5;}
    
    int xo=0; if(pdx<0){ xo=-20;} else{ xo=20;}
    int yo=0; if(pdy<0){ yo=-20;} else{ yo=20;}
    int ipx=px/64.0, ipx_add_xo=(px+xo)/64.0, ipx_sub_xo=(px-xo)/64.0;
    int ipy=py/64.0, ipy_add_yo=(py+yo)/64.0, ipy_sub_yo=(py-yo)/64.0;
    if (Keys.w==1)
    {
        if(map[ipy*mapX        + ipx_add_xo]==0){ px+=pdx;}
        if(map[ipy_add_yo*mapX + ipx       ]==0){ py+=pdy;}
    }
    if (Keys.s==1)
    {
        if(map[ipy*mapX        + ipx_sub_xo]==0){ px-=pdx;}
        if(map[ipy_sub_yo*mapX + ipx       ]==0){ py-=pdy;}
    }
    clear(); 
    drawMap2D();
    drawPlayer(); 
    drawRadys3D();

    return (0);
}

int    ButtonDown(int key, datamlx *soid)
{
    if (key == A)
        Keys.a=1;
    if (key == D) 
        Keys.d=1;
    if (key == W) 
        Keys.w=1;
    if (key == S) 
        Keys.s=1;
    if (key == ESC)
        exit(0);
    return (0);
}

int    ButtonUp(int key, datamlx *soid)
{
    if (key == A)
        Keys.a=0;
    if (key == D) 
        Keys.d=0;
    if (key == W) 
        Keys.w=0;
    if (key == S) 
        Keys.s=0;
    return(0);
}

void    init()
{
    int p = 8,d=64;
    data.img = mlx_new_image(data.mlx_ptr, GLSW/2,GLSH);
    data.img1 = mlx_xpm_file_to_image(data.mlx_ptr, "pg.xpm", &p, &p);
    data.img2 = mlx_xpm_file_to_image(data.mlx_ptr, "dot.xpm", &p, &p);
    data.img4 =mlx_new_image(data.mlx_ptr, GLSW/2, GLSH);
    data.addr = mlx_get_data_addr(data.img, &data.bppx, &data.line_len, &data.endian);
    data.addr2 = mlx_get_data_addr(data.img4, &data.bppx2, &data.line_len2, &data.endian2);
    px=300; py=300; pdx=cos(pa)*5; pdy=sin(pa)*5;
}

int main()
{
    data.mlx_ptr = mlx_init();
    data.win_ptr = mlx_new_window(data.mlx_ptr, GLSW,GLSH, "Ray1.1");
    init();
    //display(&data);
    mlx_loop_hook(data.mlx_ptr, display, &data);
    mlx_hook(data.win_ptr, 2, 1L << 0, ButtonDown, &data);
    mlx_hook(data.win_ptr, 3, 1L << 1, ButtonUp, &data);
    mlx_loop(data.mlx_ptr);
}